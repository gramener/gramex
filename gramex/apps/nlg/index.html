<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>GramexNLG Template Generator</title>
</head>

<body>
    {% from gramex.apps.nlg.webapp import read_current_config %}
    {% set dsid = read_current_config(handler)['dsid'] %}
    <div class="formhandler" data-src="nlg/preview/{{ handler.current_user.email }}/{{ dsid }}"></div>
    <!-- Include JS dependencies  -->
    <script src="ui/popper.js/dist/umd/popper.min.js"></script>
    <script src="ui/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="nlg/nlg.js"></script>
    <script>
        // Render the FormHandler table

        $.fn.selectpicker.Constructor.BootstrapVersion = '4'
        var df = null;
        var args = null;
        var templates = [];
        var currentEventHandlers = {};
        var currentEditIndex = null;
        var currentSpanId = null;
        var grammarOptions = []
        var narrative_name = "";
        var dataset_name = "";
        // setContextMenu();
        $('.formhandler').on('load', renderPreview);
        $('.formhandler').formhandler();
        $(document).ready(setInitialConfig)
    </script>
    <div>
        <input class="form-control mx-1 underline border-success"
        id="narrative-name-editor" placeholder="Name the Narrative">
    </div>
    <form id="myform" enctype="multipart/form-data">
        <div>
            <label for="textbox">Type Something</label>:
            <div>
                <textarea id="textbox" name="textbox" style="font-family:monospace"></textarea>
            </div>
        </div>
        <p>
            <button id="inspect" type="button" title="Add to Template"
                class="btn btn-primary">
                <i class="fa fa-plus-square"></i>
            </button>
        </p>
    </form>
    <p id="template-preview" style="font-family:monospace"></p>
    <br>
    <div class="d-flex">
        <button id="download-btn" type="button" title="Download Narrative" class="btn btn-primary">
            <i class="fa fa-download"></i>
        </button>
        <button id="download-config-btn" type="button" title="Save Config" class="btn btn-success">
            <i class="fa fa-save"></i>
        </button>
        <button id="share-narrative-btn" type="button" title="Share Narrative" class="btn btn-success">
            <i class="fa fa-share"></i>
        </button>
    </div>
    <!--
    <button id="clear-tmpls" title="Clear Narrative" type="button" class="btn btn-danger">
        <i class="fa fa-trash"></i>
    </button>
    -->
    <div class="modal fade" id="share-modal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <p>Editor</p>
                <textarea id="share-editor-url" style="font-family: monospace"></textarea>
                <button id="copy-editor-url" title="Copy To Clipboard" type="button" class="btn btn-primary">
                    <i class="fa fa-copy"></i>
                </button>
                <p>Narrative</p>
                <textarea id="share-narrative-url" style="font-family: monospace"></textarea>
                <button id="copy-narrative-url" title="Copy To Clipboard" type="button" class="btn btn-primary">
                    <i class="fa fa-copy"></i>
                </button>
            </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="template-settings" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h6>Template Settings:</h6></div>
                <div id="tmpllist" class="modal-body">
                    <div>
                        <div class="d-flex">
                            <input class="form-control mx-1 underline border-success"
                            id="tmpl-name-editor" placeholder="Name the template">
                            <button id="tmpl-name-btn" type="button" class="btn btn-primary success">
                                <i class="fa fa-check"></i>
                            </button>
                        </div>
                        <div class="d-flex">
                            <div class="text-middle h6 mr-2 p-2">
                                <div class="align-center" id="tmpl-setting-preview"></div>
                            </div>
                        </div>
                        <div class="d-flex">
                            <input class="form-control mx-1 underline border-success"
                            id="condition-editor" placeholder="Add condition">
                            <button id="condition-btn" type="button" class="btn btn-primary success">
                                <i class="fa fa-check"></i>
                            </button>
                        </div>
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="fh-arg-setter">
                            <label class="custom-control-label" for="fh-arg-setter">Set current data</label>
                            </div>
                        <br>
                        <textarea id="edit-template" class="align-center"
                        name="templateditor"
                        style="font-family:monospace; font-size:10pt; width: 50em"></textarea>
                        <br>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Token</th>
                                    <th scope="col">Search Results</th>
                                    <th scope="col">Grammar</th>
                                    <th scope="col">Make Variable</th>
                                    <th scope="col"><!--Remove--></th>
                                </tr>
                            </thead>
                            <tbody id="table-body">
                                <!--dummy code starts-->
                            </tbody>
                        </table>
                        <div id="srdd"></div>
                        <button id="check-template" title="Run template" type="button" class="btn btn-primary">
                            <i class="fa fa-play"></i>
                        </button>
                        <button id="save-template" title="Save Template" type="button" class="btn btn-primary" disabled>
                            <i class="fa fa-save"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="alert alert-success alert-dismissable collapse" role="alert">
        <strong>Saved!</strong>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <!-- Template preview -->
    <script>
        document.getElementById("download-btn").addEventListener("click", downloadNarrative);
        document.getElementById("download-config-btn").addEventListener("click", saveConfig);
        // document.getElementById("config-upload").addEventListener("change", uploadConfig, false);
        document.getElementById("inspect").addEventListener("click", addToNarrative);
        document.getElementById("check-template").addEventListener("click", checkTemplate);
        var saveBtn = document.getElementById("save-template")
        saveBtn.addEventListener("click", saveTemplate);
        document.getElementById("edit-template").addEventListener('focus', function (e) {saveBtn.disabled = false})
        document.getElementById("condition-btn").addEventListener("click", addCondition);
        document.getElementById("share-narrative-btn").addEventListener("click", shareNarrative);
        document.getElementById("copy-editor-url").addEventListener("click",
            function (e) {copyToClipboard('share-editor-url')});
        document.getElementById("copy-narrative-url").addEventListener("click",
            function (e) {copyToClipboard('share-narrative-url')});
        document.getElementById("tmpl-name-btn").addEventListener("click", addName);
        document.getElementById("fh-arg-setter").addEventListener("change", changeFHSetter)
        // document.getElementById("clear-tmpls").addEventListener('click', clearNarrative);
        document.getElementById("textbox").cols = 119;
        document.getElementById("edit-template").cols = 69;
        document.getElementById("edit-template").rows = 10;
        $.ajax({
            type: "GET",
            url: "nlg/get-gramopts",
            success: function (resp) { grammarOptions = resp }
        })
    </script>
</body>

</html>
