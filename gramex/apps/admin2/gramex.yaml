import:
  apps/admin2/ui:
    path: $GRAMEXAPPS/ui/gramex.yaml
    YAMLURL: $YAMLURL/ui/

url:
  # webshell.js is in ../admin/ and used by old admin app. Point it it
  apps/admin2/webshell-static-$*:
    pattern: /$YAMLURL/(webshell\..*)
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/../admin/

  apps/admin2/home-static-$*:
    pattern: /$YAMLURL/(.*)
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/

  apps/admin2/home-$*:
    pattern: /$YAMLURL/
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/index.html
      template: true
      admin_kwargs: $ADMIN_KWARGS
      auth: $ADMIN_AUTH
      # Admin panel configuration
      components:
        'users':
          title: Users
          desc: Add, rename, and manage users and roles
          color: primary
          icon: fa-user
        'shell':
          title: Shell
          desc: Run Python commands within Gramex
          color: danger
          icon: fa-terminal
        'info':
          title: Info
          desc: Server OS and environment information
          color: info
          icon: fa-info
        'config':
          title: Config
          desc: View Gramex configuration (gramex.yaml)
          color: secondary
          icon: fa-wrench
        'logs':
          title: Logs
          desc: Track usage and errors in Gramex
          color: success
          icon: fa-align-left
        'nlg':
          title: Natural Language Generation
          desc: Generate narratives from your data
          color: danger
          icon: fa-language

  apps/admin2/users-$*:
    pattern: /$YAMLURL/users
    handler: gramexadmin.AdminFormHandler
    kwargs:
      admin_kwargs: $ADMIN_KWARGS
      auth: $ADMIN_AUTH

  apps/admin2/webshell-$*:
    pattern: /$YAMLURL/webshell
    handler: WebSocketHandler
    kwargs:
      auth: $ADMIN_AUTH
      on_message:
        function: gramexadmin.evaluate(handler, message)

  apps/admin2/info-$*:
    pattern: /$YAMLURL/info
    handler: FunctionHandler
    kwargs:
      function: gramexadmin.system_information
      auth: $ADMIN_AUTH
      headers:
        Content-Type: application/json      # Display as JSON
  
  # NLG Webapp handlers
  apps/admin2/nlg-data-selector-$*:
    pattern: /$YAMLURL/initform
    handler: FunctionHandler
    kwargs:
      headers:
        Cache-Control: no-store
      xsrf_cookies: false
      function: gramex.nlg.webapp.init_form
      redirect:
        url: /$YAMLURL/nlg-editor
  apps/admin2/nlg-editor-filehander-$*:
    pattern: /$YAMLURL/nlg-editor
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/nlg/index.html
      template: true
      auth:
        login_url: /$YAMLURL/login
  apps/admin2/tablepreview-$*:
    pattern: /$YAMLURL/preview/(.*)/(.*)
    handler: FormHandler
    kwargs:
      url: $GRAMEXDATA/nlg/{_0}/{_1}
      headers:
        Cache-Control: no-store
  apps/admin2/nlg-static_files-$*:
    pattern: /$YAMLURL/nlg.js
    handler: FileHandler
    kwargs:
      path: $YAMLPATH/nlg/js/nlg.js
  apps/admin2/nlg-config-handler-$*:
    pattern: /$YAMLURL/initconf
    handler: FunctionHandler
    kwargs:
      function: gramex.nlg.webapp.get_init_config
      headers:
        Content-Type: application/json 
  apps/admin2/textproc-$*:
    pattern: /$YAMLURL/textproc
    handler: FunctionHandler
    priority: 1000000
    kwargs:
      function: gramex.nlg.webapp.process_template
      xsrf_cookies: false
      headers:
        Content-Type: application/json
  apps/admin2/rendertmpl-$*:
    pattern: /$YAMLURL/render-template
    handler: FunctionHandler
    kwargs:
      function: gramex.nlg.webapp.render_template
      xsrf_cookies: false
      headers:
        Content-Type: application/json
  apps/admin2/nlg_gramopts-$*:
    pattern: /$YAMLURL/get-gramopts
    handler: FunctionHandler
    kwargs:
      function: gramex.nlg.webapp.get_gramopts
      xsrf_cookies: false
      headers:
        Content-Type: application/json
